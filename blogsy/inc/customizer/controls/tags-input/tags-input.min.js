/**
 * Blogsy Tags Input Control - Vanilla JavaScript
 *
 * A pure JavaScript implementation for creating tags on-the-fly
 * Comma and Enter key trigger tag creation
 * No third-party dependencies required
 *
 * @package Blogsy
 * @since 1.0.0
 * @license GPL-2.0+
 */
!function(t){"use strict";wp.customize.controlConstructor["blogsy-tags-input"]=wp.customize.Control.extend({ready:function(){this.initTagsInput()},initTagsInput:function(){var a=this,e=a.container.find(".blogsy-tags-container"),n=e.find(".blogsy-tags-input"),s=a.container.find(".blogsy-tags-value"),i=parseInt(e.data("max-tags"))||0,o=!0===e.data("allow-duplicates")||"true"===e.data("allow-duplicates");n.on("keydown",(function(n){var l=n.key||n.keyCode,g=t(this).val().trim();if("Enter"!==l&&13!==l&&","!==l&&188!==l||(n.preventDefault(),g&&(g=g.replace(/,$/g,""))&&(a.addTag(e,g,i,o,s),t(this).val(""))),("Backspace"===l||8===l)&&!g){var r=e.find(".blogsy-tag");r.length>0&&(r.last().remove(),a.updateValue(e,s))}})),n.on("paste",(function(l){setTimeout((function(){var l=n.val().split(/[,\n]+/);n.val(""),t.each(l,(function(t,n){(n=n.trim())&&a.addTag(e,n,i,o,s)}))}),10)})),e.on("click",".blogsy-tag-remove",(function(){t(this).closest(".blogsy-tag").fadeOut(200,(function(){t(this).remove(),a.updateValue(e,s)}))})),e.on("click",(function(a){(a.target===this||t(a.target).hasClass("blogsy-tags-container"))&&n.focus()}))},addTag:function(a,e,n,s,i){var o=this;if(!(e=e.trim()))return!1;var l=a.find(".blogsy-tag").length;return n>0&&l>=n?(o.showNotice(a,"Maximum "+n+" tags allowed"),!1):!s&&o.tagExists(a,e)?(o.showNotice(a,"Tag already exists"),!1):(t('<span class="blogsy-tag">').append(t('<span class="blogsy-tag-text">').text(e)).append(t('<span class="blogsy-tag-remove" role="button" aria-label="Remove tag">').html("&times;")).hide().insertBefore(a.find(".blogsy-tags-input")).fadeIn(200),o.updateValue(a,i),!0)},tagExists:function(a,e){var n=!1,s=e.toLowerCase();return a.find(".blogsy-tag-text").each((function(){if(t(this).text().toLowerCase()===s)return n=!0,!1})),n},updateValue:function(a,e){var n=[];a.find(".blogsy-tag-text").each((function(){n.push(t(this).text())}));var s=n.join(",");e.val(s).trigger("change"),this.setting.set(s)},showNotice:function(a,e){var n=a.find(".blogsy-tags-notice");0===n.length&&(n=t('<div class="blogsy-tags-notice">').appendTo(a)),n.text(e).fadeIn(200),setTimeout((function(){n.fadeOut(200)}),2e3)}})}(jQuery);
