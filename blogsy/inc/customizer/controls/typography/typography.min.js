!function(t){"use strict";wp.customize.controlConstructor["blogsy-typography"]=wp.customize.Control.extend({ready:function(){var n=this,e=n.setting.get(),o=n.container.find(".popup-content");n.container.find("#font-family-"+n.params.id).select2(),n.container.find("#font-subsets-"+n.params.id).select2(),n.update_font_subsets_field(e["font-family"]),n.container.on("change","#font-family-"+n.params.id,(function(){n.update_font_weight_field(t(this).val()),n.update_font_subsets_field(t(this).val())})),n.container.find(".blogsy-font-color-control").wpColorPicker({change:function(t,e){setTimeout((()=>{n.update_value()}),0)},clear:function(){setTimeout((()=>{n.update_value()}),0)}}),n.container.on("change","[data-option]",(function(){n.update_value()})),n.container.find(".blogsy-range-wrapper").each((function(){var o=t(this);_.isUndefined(o.rangeControl)||o.rangeControl({id:n.params.id+"-"+o.data("option-id"),option:o.data("option-id"),unit:n.params.units[o.data("option-id")],value:e[o.data("options-id")],responsive:n.params.responsive,change:function(){n.update_value()}})})),n.container.on("select2:opening","#font-family-"+n.params.id,(function(){n.populate_font_family_field(),n.container.off("select2:opening","#font-family-"+n.params.id)})),n.container.on("mousedown",'[data-option="font-weight"]',(function(){n.update_font_weight_field(n.container.find("#font-family-"+n.params.id).val()),n.container.off("mousedown",'[data-option="font-weight"]')})),n.container.on("select2:opening","#font-subsets-"+n.params.id,(function(){n.update_font_subsets_field(n.container.find("#font-family-"+n.params.id).val()),n.container.off("mousedown",'[data-option="font-subsets"]')})),n.container.find(".popup-link").on("click",(function(){o.toggleClass("hidden"),t(this).toggleClass("active"),t(this).siblings(".reset-defaults").toggleClass("active"),t("body").on("click",i)})),n.container.find(".reset-defaults").on("click",(function(){if("font-family"in n.params.display&&(n.populate_font_family_field(),n.container.find("#font-family-"+n.params.id).val(n.params.default["font-family"]).trigger("change")),["font-weight","font-style","text-transform","text-decoration"].forEach((t=>{t in n.params.display&&n.container.find('[data-option="'+t+'"]').val(n.params.default[t]).trigger("change")})),["font-size","line-height","letter-spacing"].forEach((t=>{n.container.find('[data-option-id="'+t+'"]').find(".blogsy-reset-range").click()})),"color"in n.params.display){var t=n.container.find(".blogsy-font-color-control");if(t.length)if(n.params.default.color)t.wpColorPicker("color",n.params.default.color);else{var e=t.data("wpWpColorPicker");t.val(""),e&&e.toggler&&e.toggler.css("background-color",""),t.trigger("clear"),t.trigger("change")}}}));var i=function(e){t(e.target).closest(".select2-container").length||t(e.target).closest(".customize-save-button-wrapper").length||t(e.target).closest(".reset-defaults").length||n.container.has(t(e.target).closest(".popup-link")).length||n.container.has(t(e.target).closest(".popup-content")).length||o.hasClass("hidden")||(o.addClass("hidden"),n.container.find(".popup-link").removeClass("active"),n.container.find(".reset-defaults").removeClass("active"),t("body").off("click",i))}},update_value:function(){var n,e={};this.container.find("[data-option]").each((function(){n=t(this).data("option"),e[n]="font-size-unit"===n||"line-height-unit"===n||"letter-spacing-unit"===n?t(this).is(":checked")?t(this).val():e[n]:t(this).val()})),this.setting.set(e)},update_font_weight_field:function(n){var e=this,o="",i="",a=e.setting.get();if("inherit"===n&&(i=' selected="selected"'),o+='<option value="inherit"'+i+">"+e.params.l10n.inherit+"</option>","inherit"===n||"default"===n){t.each(["100","200","300","400","500","600","700","800","900"],(function(t,n){i=n===a["font-weight"]?' selected="selected"':"",o+='<option value="'+n+'"'+i+">"+e.params.l10n.weights[n]+"</option>"}))}else t.each(blogsy_typography_vars.fonts,(function(s,l){void 0===l.fonts[n]||t.each(l.fonts[n].variants,(function(t,n){i=n===a["font-weight"]?' selected="selected"':"",o+='<option value="'+n+'"'+i+">"+e.params.l10n.weights[n]+"</option>"}))}));e.container.find(".blogsy-typography-font-weight").find("select").html(o)},update_font_subsets_field:function(n){var e="",o="",i=this.setting.get(),a=this.container.find(".blogsy-typography-font-subsets");"default"!==n&&"inherit"!==n?(t.each(blogsy_typography_vars.fonts,(function(s,l){if(void 0!==l.fonts[n])return"system_fonts"===s||"standard_fonts"===s?a.hide():a.show(),void t.each(l.fonts[n].subsets,(function(t,n){o="",(i["font-subsets"]&&-1!==i["font-subsets"].indexOf(n)||"latin"===n)&&(o=' selected="selected"'),e+='<option value="'+n+'"'+o+">"+n+"</option>"}))})),a.find("select").html(e)):a.hide()},populate_font_family_field:function(n){var e=this,o="",i="",a=e.setting.get();i="inherit"===a["font-family"]?' selected="selected"':"",o+='<option value="inherit"'+i+">"+e.params.l10n.inherit+"</option>",i="default"===a["font-family"]?' selected="selected"':"",o+='<option value="default"'+i+">"+e.params.l10n.default+"</option>",t.each(blogsy_typography_vars.fonts,(function(n,e){o+='<optgroup label="'+e.name+'">',t.each(e.fonts,(function(t,n){i=t===a["font-family"]?' selected="selected"':"",o+='<option value="'+t+'"'+i+">"+t+"</option>"})),o+="</optgroup>"})),e.container.find("#font-family-"+e.params.id).html(o)}})}(jQuery);
